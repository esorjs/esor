var $=Object.defineProperty;var V=e=>{throw TypeError(e)};var ce=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var r=(e,t)=>$(e,"name",{value:t,configurable:!0});var A=(e,t,n)=>ce(e,typeof t!="symbol"?t+"":t,n),z=(e,t,n)=>t.has(e)||V("Cannot "+n);var T=(e,t,n)=>(z(e,t,"read from private field"),n?n.call(e):t.get(e)),S=(e,t,n)=>t.has(e)?V("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),O=(e,t,n,o)=>(z(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);var a=null,M=0,H=new Set,b=r(e=>{let t=e,n=[],o=r(s=>{if(s===void 0)return a&&!n.includes(a)&&(n.push(a),a.subs&&a.subs.add(o)),t;let u=typeof s=="function"?s(t):s;if(!Object.is(u,t))if(t=u,M>0)for(let c=0;c<n.length;c++)H.add(n[c]);else{let c=n.slice();for(let l=0;l<c.length;l++)c[l]()}return t},"getterSetter");return o.subs=n,o},"signal"),d=r(e=>{let t=new Set,n=!1,o=r(()=>{if(n)return;n=!0;let s=a;a=o;try{e()}finally{a=s,n=!1}},"reactive");return o.subs=t,o(),()=>{t.forEach(s=>{let u=s.subs.indexOf(o);u!==-1&&s.subs.splice(u,1)}),t.clear()}},"effect"),D=r(e=>{let t=b(e());return d(()=>t(e())),()=>t()},"computed"),F=r(e=>{M++;try{return e()}finally{if(M--,M===0){let t=Array.from(H);H.clear(),t.forEach(n=>n())}}},"batch");function k(e,t,n=null){let o=new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,cancelable:!0});return n&&n.dispatchEvent(o),o}r(k,"emit");function X(e=null){let t=e;return n=>n!==void 0?t=n:t}r(X,"ref");var q=r(e=>e==null?"":String(e).replace(/[&<>'"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[t]),"sanitizeHtml");function G(e){return e&&(e.__nodeGroups=!0),e}r(G,"markNode");function x(e){return C(e,G)}r(x,"markedFragment");function C(e,t=null,n=null){let o=document.createDocumentFragment();if(!e?.length)return o;for(let s of e)s&&(s=typeof t=="function"?t(s,o):s,Array.isArray(s)?o.appendChild(C(s,t)):o.appendChild(s));return n&&o.childNodes.length&&n.appendChild(o),o}r(C,"createFragment");function P(e,t){if(!e||!t||!t.parentNode)return;let n=t.parentNode,o=r(i=>{for(let f of i)!f||f.parentNode!==n||(f._cleanup&&typeof f._cleanup=="function"&&f._cleanup(),n.removeChild(f))},"removeNodes"),s=r((i,f)=>i.length!==f.length||i.some((h,g)=>!h.isEqualNode(f[g])),"nodesChanged"),u=t.__nodeGroups||[],c=new Map(u.map(i=>[i.key,i])),l=e.map((i,f)=>{let h=Array.isArray(i)?i.filter(Boolean):[i];return{key:h.find(ie=>ie?.getAttribute?.("key")!=null)?.getAttribute("key")||`__key_${f}`,nodes:h}}),N=new Map(l.map(i=>[i.key,i]));for(let i of u)!N.has(i.key)&&o(i.nodes);let p=t;for(let i of l){let f=c.get(i.key);if(f)if(s(f.nodes,i.nodes))o(f.nodes),n.insertBefore(x(i.nodes),p.nextSibling);else{let h=p.nextSibling;if(f.nodes[0]!==h){let g=document.createDocumentFragment();for(let B of f.nodes)g.appendChild(B);n.insertBefore(g,h)}i.nodes=f.nodes}else n.insertBefore(x(i.nodes),p.nextSibling);p=i.nodes[i.nodes.length-1]||p}t.__nodeGroups=l}r(P,"reconcile");var L=new WeakMap,E="\uFEFF";function W(e){let t=document.createElement("template");return t.innerHTML=e,t}r(W,"createTemplate");var j=r((e,t,n)=>{if(t)if(e.removeAttribute(t),t==="ref")typeof n=="function"?n(e):n&&(n.current=e);else if(t[0]=="o"&&t[1]=="n"&&typeof n=="function"){let o=t.slice(2).toLowerCase();e.addEventListener(o,n),e._cleanup=()=>e.removeEventListener(o,n)}else t==="style"&&typeof n=="object"?d(()=>Object.assign(e.style,n)):typeof n=="function"?d(()=>I(e,t,n())):I(e,t,n);else fe(e,n)},"render");function I(e,t,n){t==="value"||t==="checked"?e[t]=n:n===!1||n===null||n===void 0?e.removeAttribute(t):e.setAttribute(t,n)}r(I,"setAttribute");function fe(e,t){let n=r(o=>{if(typeof o=="boolean"&&(o=""),Array.isArray(o))P(o,e);else{let s=document.createTextNode(q(typeof o=="string"?o:String(o??"")));G(s),ue(e,[s])}},"updateContent");typeof t=="function"?d(()=>n(t())):n(t)}r(fe,"setContent");function ue(e,t){let n=e.parentNode,o=e.nextSibling;for(;o&&o.__nodeGroups;)o._cleanup&&o._cleanup(),n.removeChild(o),o=e.nextSibling;t?.length&&le(x(t),n,e.nextSibling)}r(ue,"replaceNodes");function le(e,t,n=null){!e||!t||(n&&n.parentNode===t?t.insertBefore(e,n):t.appendChild(e))}r(le,"insertFragment");function pe(e,t){let n=[],o=document.createTreeWalker(e.content,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(;o.nextNode();)n.push(o.currentNode);let s=0;for(let u=0;u<n.length;u++){let c=n[u];if(c.nodeType===Node.ELEMENT_NODE&&c.attributes.length)for(let l of Array.from(c.attributes))l.value===E&&j(c,l.name,t[s++]);else if(c.nodeType===Node.TEXT_NODE&&c.nodeValue.includes(E))if(c.nodeValue===E){let l=document.createComment("");c.parentNode.replaceChild(l,c),j(l,null,t[s++])}else{let l=W(c.nodeValue.replaceAll(E,"<!>")),N=Array.from(l.content.childNodes);for(let p=0;p<N.length;p++){let i=N[p];i.nodeType===Node.COMMENT_NODE&&j(i,null,t[s++])}c.parentNode.replaceChild(l.content,c)}}}r(pe,"processTemplate");function J(e,t=null){let n=W(e);return typeof t=="function"&&t(n),[...n.content.childNodes]}r(J,"templateToNodes");function Q(e,...t){if(e.length===1)return J(e[0]);if(!t.length)return J(e.join(""));let n=e.join(E),o=W(n);return pe(o,t),[...o.content.childNodes]}r(Q,"build");function U(e,...t){return L.has(e)?Q(L.get(e),...t):(L.set(e,e),Q(e,...t))}r(U,"html");function _(e,t,n="error"){let o=n==="warn"?console.warn:console.error,s=t instanceof Error?t:new Error(String(t));return o(`[Esor Error] ${e}:`,s.message),s}r(_,"handleError");var m=null,R=r(e=>m=e,"createLifecycle"),y=r((e,t)=>{if(!m){_("lifecycle","Hook called outside component setup");return}m._lifecycles[e]||(m._lifecycles[e]=[]),m._lifecycles[e].push(t)},"addHook"),w=r(e=>{if(m?._lifecycles?.[e])for(let t of m._lifecycles[e])queueMicrotask(()=>t.call(m),"lifecycle.runHook")},"runHook"),Y=r(e=>{let t=e();return typeof t=="function"?y("destroy",t):()=>{}},"onEffect"),Z=r(e=>y("beforeMount",e),"beforeMount"),K=r(e=>y("mount",e),"onMount"),v=r(e=>y("beforeUpdate",e),"beforeUpdate"),ee=r(e=>y("update",e),"onUpdate"),te=r(e=>y("destroy",e),"onDestroy");var ae=/^-?\d+(?:\.\d+)?(?:e[+-]?\d+)?$/;function ne(e){if(e==null)return"";if(e==="true")return!0;if(e==="false")return!1;if(ae.test(e))return Number(e);if(typeof e=="string"&&(e[0]==="{"||e[0]==="["))try{return JSON.parse(e)}catch{}return e}r(ne,"parseAttributeValue");function oe(e){for(let n of e.attributes){let{name:o,value:s}=n;o.startsWith("on")||o.startsWith("ref")||(e.props[o]=b(ne(s)))}let t=new MutationObserver(n=>{for(let o of n){let s=o.attributeName;if(!s||s.startsWith("on")||s.startsWith("ref"))continue;let u=e.props[s];u&&u(ne(e.getAttribute(s)))}});t.observe(e,{attributes:!0}),e._cleanup.push(()=>t.disconnect())}r(oe,"initPropsAndObserve");function re(e){e&&(e.emit=(t,n)=>k(t,n,e))}r(re,"initDispatch");var de=/^[a-z][a-z0-9-]*$/,me="open",he=r((e,t={})=>{var n,o,s;return s=class extends HTMLElement{constructor(){super();S(this,n,this.attachShadow({mode:t.mode||me}));S(this,o,!1);A(this,"props",Object.create(null));A(this,"_lifecycles",{beforeMount:[],mount:[],beforeUpdate:[],update:[],destroy:[]});A(this,"_cleanup",[]);R(this),re(this),oe(this);let c=e?.call(this,this.props);C(c||[c],null,T(this,n)),w("beforeMount")}connectedCallback(){T(this,o)||(O(this,o,!0),w("mount"))}disconnectedCallback(){w("destroy"),this._cleanup.forEach(c=>c()),this._cleanup=[],O(this,o,!1)}},n=new WeakMap,o=new WeakMap,s},"BaseComponent"),se=r((e,t,n={})=>{if(!(typeof customElements>"u")){if(!de.test(e))return _("component",`Invalid tag name: ${e}`,"error");if(customElements.get(e))return _("component",`${e} already registered`,"warn");customElements.define(e,he(t,n))}},"component");export{F as batch,Z as beforeMount,v as beforeUpdate,se as component,D as computed,d as effect,k as emit,U as html,te as onDestroy,Y as onEffect,K as onMount,ee as onUpdate,X as ref,b as signal};
//# sourceMappingURL=esor.min.js.map
