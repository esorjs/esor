var K=Object.defineProperty;var G=e=>{throw TypeError(e)};var Pe=(e,t,n)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var i=(e,t)=>K(e,"name",{value:t,configurable:!0});var L=(e,t,n)=>Pe(e,typeof t!="symbol"?t+"":t,n),Q=(e,t,n)=>t.has(e)||G("Cannot "+n);var E=(e,t,n)=>(Q(e,t,"read from private field"),n?n.call(e):t.get(e)),j=(e,t,n)=>t.has(e)?G("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var Y=(e,t,n)=>(Q(e,t,"access private method"),n);var m,w,ee,S=class S{constructor(){j(this,w);j(this,m,new Map);S.current=this}add(t,n){return Y(this,w,ee).call(this,t).add(n),()=>E(this,m).get(t)?.delete(n)}run(t,n){E(this,m).get(t)?.forEach(r=>{try{r.call(n)}catch(o){n._catchError(o)}})}clear(t){t?E(this,m).delete(t):E(this,m).clear()}};m=new WeakMap,w=new WeakSet,ee=i(function(t){return E(this,m).has(t)||E(this,m).set(t,new Set),E(this,m).get(t)},"#hooks"),i(S,"Lifecycle"),L(S,"current");var x=S,Z=i(()=>x.current||(()=>{throw"Lifecycle not initialized"})(),"getLC"),[te,ne,re,oe,ie]=["beforeMount","mount","beforeUpdate","update","destroy"].map(e=>t=>Z().add(e,t)),se=i(e=>{let t=e();return t instanceof Function&&Z().add("destroy",t)||(()=>{})},"onEffect");var v={currentEffect:null,currentComponent:null,pendingEffects:new Set,isEffectsFlushing:!1,globalEvents:{handlersByType:new Map,nextId:0}},u=v;function C(e,t){let n=v.currentComponent;v.currentComponent=e;try{return t()}finally{v.currentComponent=n}}i(C,"withCurrentComponent");function P(e,t){return!Object.is(e,t)}i(P,"valuesChanged");var ce=i(e=>e instanceof DocumentFragment&&e||e?.content?.cloneNode()||document.createDocumentFragment(),"getDocumentFragment");function le(e,t){let n=e.nextSibling;for(;n&&n!==t;){let r=n.nextSibling;n.parentNode.removeChild(n),n=r}}i(le,"removeChildNodesBetween");var _=i((e,t)=>{let n=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT),[r,o]=[null,null];for(;n.nextNode()&&!o;){let c=n.currentNode;!r&&c.nodeValue===t?r=c:r&&c.nodeValue===`//${t}`&&(o=c)}return[r,o]},"findCommentPlaceholders");function fe(e){let n=HTMLElement.prototype.hasOwnProperty("attachInternals")?e.attachInternals():null;n?.shadowRoot?e.shadowRoot=n.shadowRoot:e.attachShadow({mode:"open"})}i(fe,"setupDeclarativeShadowRoot");function D(e,t){return new Proxy(e,{get(n,r,o){let c=Reflect.get(n,r,o);return typeof c=="function"?function(...s){let l=c.apply(n,s);return Array.isArray(l)?(l.__signalArray=!0,l.__signal=t,s.length>0&&typeof s[0]=="function"&&(l.__mapFn=s[0]),D(l,t)):l}:c}})}i(D,"wrapArray");var H={info:{color:"#0066cc",icon:"\u2139\uFE0F"},warn:{color:"#FFA500",icon:"\u26A0\uFE0F"},error:{color:"#FF0000",icon:"\u{1F6AB}"}},U=i((e="info",t="",...n)=>{H[e]||(e="info"),console.groupCollapsed(`%c[ESOR ${H[e].icon}${De(e)}] ${t}`,`color: ${H[e].color}; font-weight: bold;`),console[e]({message:t,component:u.currentComponent?.constructor?.name||"Unknown",time:new Date().toISOString(),data:n.length?n:void 0}),console[e==="error"?"trace":"debug"](),console.groupEnd()},"log"),De=i(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"","capitalize"),xt=i((...e)=>U("info",...e),"info"),St=i((...e)=>U("warn",...e),"warn"),g=i((...e)=>U("error",...e),"error");function q(){if(u.isEffectsFlushing)return;u.isEffectsFlushing=!0;let e=Array.from(u.pendingEffects);u.pendingEffects.clear();for(let t of e)typeof t=="function"?t():g("Non-function in flushEffects:",t);u.isEffectsFlushing=!1}i(q,"flushEffects");function h(e){let t=i(()=>{let n=u.currentEffect;u.currentEffect=t;try{return e()}finally{u.currentEffect=n}},"effect");return t(),t}i(h,"useEffect");var N=0,$=new Set;function y(e){let t=new Set,n=e;function r(){return u.currentEffect&&t.add(u.currentEffect),Array.isArray(n)?D(n,r):n}i(r,"readFn");function o(s){if(P(n,s)){if(n=s,N>0){t.forEach(l=>$.add(l));return}queueMicrotask(()=>{t.forEach(l=>{typeof l=="function"&&u.pendingEffects.add(l)}),q()})}}i(o,"write");let c=new Proxy(r,{apply(s,l,f){return Reflect.apply(s,l,f)},get(s,l){if(l===Symbol.toPrimitive)return()=>r();if(l==="valueOf")return()=>c();if(l==="toString")return()=>String(c());let f=r();if(typeof f=="object"&&f!==null||typeof f=="function"){let a=Reflect.get(f,l);return typeof a=="function"?a.bind(f):a}return Reflect.get(Object(f),l)}});return Object.assign(c,{signal:!0,cleanup:i(()=>{t.clear(),n=e},"cleanup")}),[c,o]}i(y,"useSignal");function ae(e){let[t,n]=y(e());return h(()=>{let r=e();P(t(),r)&&queueMicrotask(()=>n(r))}),t}i(ae,"useComputed");function ue(e){N++;try{return e()}finally{if(N--,N===0&&$.size){for(let t of $)u.pendingEffects.add(t);$.clear(),q()}}}i(ue,"useBatch");var M=i(e=>e==null?"":e.toString().replace(/[&<>'"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","/":"&#x2F;"})[t]),"escapeHTML");function pe(e){return e==null?"":String(e).replace(/^["']|["']$/g,"").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}i(pe,"cleanAttributeValue");function F(e,t,n,r,o){n=[...n||[]],r=[...r||[]];let c=t.parentNode,s=He(e,t),l=We(r,s,n);Xe(c,s,l,t),b(o,e,t),e.__oldItems=[...r]}i(F,"reconcileArrays");function He(e,t){let n=[],r=e.nextSibling;for(;r&&r!==t;)n.push(r),r=r.nextSibling;return n}i(He,"collectNodes");function A(e){return e&&e.nodeType===Node.ELEMENT_NODE}i(A,"isValidDOMNode");function Ue(e){return A(e)?e.getAttribute("data-key"):null}i(Ue,"getNodeKey");function qe(e,t,n,r){if(!e||!t||!n?.template||!r?.template)return!1;e.firstChild?.nodeType===3&&e.normalize(),t.firstChild?.nodeType===3&&t.normalize();let o=de(e),c=de(t);if(o.length!==c.length)return!1;let s=!1;for(let l=0,f=o.length;l<f;l++){let a=o[l].textContent,p=c[l].textContent;a!==p&&(o[l].textContent=p,s=!0)}return s}i(qe,"updateNodeContent");function de(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),r;for(;r=n.nextNode();)t.push(r);return t}i(de,"getTextNodes");function We(e,t,n){let r=new Map,o=new Map,c=[e.length];for(let s=0,l=t.length;s<l;s++){let f=Ue(t[s]);f&&r.set(f,t[s])}for(let s=0,l=n.length;s<l;s++)o.set(he(n[s],s),n[s]);for(let s=0,l=e.length;s<l;s++)c[s]=he(e[s],s);return e.map((s,l)=>{let f=c[l],a=r.get(f),p=o.get(f);if(a?.nodeType===1){if(!p||ze(p,s)){let d=ge(s,f);return qe(a,d,p,s)?(Je(a,d),a):d}return a}return ge(s,f)})}i(We,"createOrReuseNodes");function ze(e,t){if(!e||!t)return!0;if(e?.template&&t?.template){let n=me(e),r=me(t);return!R(n,r)}return!R(e,t)}i(ze,"hasChanged");function me(e){let t=e?.template;if(!t)return null;let n=[],r=t.cloneNode(!0),o=document.createTreeWalker(r,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode(s){return s.nodeType===3?s.textContent.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}}),c;for(;c=o.nextNode();)if(c.nodeType===3)n.push(c.textContent);else{let s=c.attributes;for(let l=0,f=s.length;l<f;l++){let a=s[l].value;a.includes("${")&&(n[n.length]=a)}}return n}i(me,"extractDynamicValues");function R(e,t){if(e===t)return!0;if(!e||!t||typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((n,r)=>R(n,t[r]));if(typeof e=="object"){let n=Object.keys(e),r=Object.keys(t);return n.length!==r.length?!1:n.every(o=>R(e[o],t[o]))}return String(e)===String(t)}i(R,"areValuesEqual");function Je(e,t){if(!A(e)||!A(t))return;let n="data-event-",r=e.attributes;for(let o=r.length;o--;){let c=r[o];c.name.lastIndexOf(n,0)===0&&t.setAttribute(c.name,c.value)}}i(Je,"copyEventAttributes");function he(e,t){if(e?.key!==void 0)return`key-${e.key}`;if(e?.template){let n=e.template.firstElementChild;if(e.id)return`item-${e.id}`;if(n&&A(n)){let r=n.getAttribute("key");if(r)return r}return`template-${t}`}if(e&&typeof e=="object"){if(e.id)return`item-${e.id}`;try{return`item-${t}-${JSON.stringify(e)}`}catch{return`item-${t}`}}return`item-${t}-${String(e)}`}i(he,"getItemKey");function ge(e,t){let n;return e?.template?n=e.template.cloneNode(!0).firstElementChild||document.createElement("div"):(n=document.createElement("div"),n.textContent=String(e)),A(n)&&n.setAttribute("data-key",t),n}i(ge,"createNode");function Xe(e,t,n,r){let o=0,c=t.length,s=0,l=n.length,f=c>0&&t[c-1].nextSibling||r,a=null;if(c===0){for(let p=0;p<l;p++)e.insertBefore(n[p],f);return}if(l===0){for(;o<c;)e.removeChild(t[o++]);return}for(;o<c||s<l;){if(t[o]===n[s]){o++,s++;continue}for(;t[c-1]===n[l-1];)c--,l--;if(o===c){let p=l<n.length?s?n[s-1].nextSibling:n[l-s]:f;for(;s<l;)e.insertBefore(n[s++],p)}else if(s===l)for(;o<c;)(!a||!a.has(t[o]))&&e.removeChild(t[o]),o++;else if(t[o]===n[l-1]&&n[s]===t[c-1]){let p=t[--c].nextSibling;e.insertBefore(n[s++],t[o++].nextSibling),e.insertBefore(n[--l],p),t[c]=n[l]}else{if(!a){a=new Map;for(let d=s;d<l;d++)a.set(n[d],d)}let p=a.get(t[o]);if(p==null)e.removeChild(t[o++]);else if(s<p&&p<l){let d=1;for(;o+d<c&&p+d<l&&t[o+d]===n[p+d];)d++;if(d>p-s){let V=t[o];for(;s<p;)e.insertBefore(n[s++],V)}else e.replaceChild(n[s++],t[o++])}else o++}}}i(Xe,"ddiff");function O(e,t,n){let r=h(()=>{if(!e._isUpdating){e._isUpdating=!0;try{n(t())}finally{e._isUpdating=!1}}});e._cleanup.add(r)}i(O,"bindSignalToElement");function b(e,t,n){let{shadowRoot:r}=e,o=Ke(r,t,n);Ge(e,o)}i(b,"bindEventsInRange");function Ke(e,t,n){let r=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null);if(!t&&!n)for(;o.nextNode();)r.push(o.currentNode);else{let c=t?.nextSibling||e.firstChild;if(!c)return r;o.currentNode=c;do{if(o.currentNode===n)break;r.push(o.currentNode)}while(o.nextNode())}return r}i(Ke,"getElementsInRange");function Ge(e,t){for(let n of t)for(let r of Array.from(n.attributes)){if(!r.name.startsWith("data-event-"))continue;let o=r.name.replace("data-event-",""),c=parseInt(r.value,10),s=u.globalEvents.handlersByType.get(o)?.get(c);typeof s=="function"&&(n.addEventListener(o,(...l)=>C(e,()=>s.call(e,...l))),n.removeAttribute(r.name))}}i(Ge,"bindEvents");function ye(e,t){t&&t.forEach(({type:n,signal:r,bindAttr:o,attributeName:c})=>{if(n==="attribute"){let s=e.shadowRoot.querySelector(`[${o}]`);if(!s)return;s.removeAttribute(o),O(e,r,l=>{let f=String(l);s.getAttribute(c)!==f&&s.setAttribute(c,f)})}else if(n==="array"){let[s,l]=_(e.shadowRoot,o);if(!s||!l)return;O(e,r,f=>{let a=s.__oldItems||[];F(s,l,a,Array.isArray(f)?f:[],e)})}else(n==="text"||n==="expression")&&be({host:e,type:n,signal:r,bindAttr:o})})}i(ye,"setupSignals");function Ee(e,t){if(t)for(let[n,r]of t.entries()){let o=e.shadowRoot.querySelector(`[data-ref-${n}]`);o&&(o.removeAttribute(`data-ref-${n}`),r(o))}}i(Ee,"setupRefs");var k=new Map;function xe(e,t){if(!e||typeof t!="function")return g("Invalid event registration parameters"),-1;let n=k.get(e);n||(n=new Map,k.set(e,n));let r=u.globalEvents.handlersByType.get(e);r||(r=new Map,u.globalEvents.handlersByType.set(e,r));let o=u.globalEvents.nextId++,c=u.currentComponent;return c&&c._eventIds.push({type:e,id:o}),r.set(o,t),n.set(o,t),o}i(xe,"registerEvent");function Kt(e,t){let n=u.globalEvents.handlersByType.get(e);if(n){n.delete(t),n.size===0&&u.globalEvents.handlersByType.delete(e);let r=k.get(e);r&&(r.delete(t),r.size===0&&k.delete(e))}}i(Kt,"clearEventHandler");function Se(e,t){let n=u.currentComponent;if(!n)return g("useEmit must be used within a component"),null;let r=new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,cancelable:!0});return r.__esor={name:e,detail:t,receivedBy:[],timestamp:Date.now()},n.dispatchEvent(r),r}i(Se,"useEmit");var Le=/\s(\w[\w-]*)=(["'])?(?:(?!\2).)*$/,Ae=/ref=(["'])?\s*$/,Te=/(@\w+)=(["'])?\s*$/,Qe=/(["'])\s*$/,Ye=/^(script|style|textarea|title)$/i,W=i(e=>e&&e.charAt(e.length-1)==='"'?'"':"'","getSafeQuote"),Ze=i(e=>e.replace(Qe,""),"trimQuote"),T=i(e=>e&&typeof e=="object"&&e.template,"isTemplateObject");function et(e,t,n,r){let o=W(t);return r.set(n,e),t.replace(Ae,`data-ref-${n}=${o}true${o}`)}i(et,"injectRef");function tt(e,t,n){let r=W(n),o=xe(t,e);return e.isEventHandler=!0,n.replace(Te,`data-event-${t}=${r}${o}${r}`)}i(tt,"injectEvent");function nt(e,t,n,r,o){n=Ze(n);let c=W(n)||'"',s=typeof e=="function"?e():e,l=Ye.test(t)?String(s):M(s),f=`data-bind-${r}`;return n+=`${c}${l}${c} ${f}=${c}true${c}`,o.set(r,{type:"attribute",signal:e,attributeName:t,bindAttr:f}),n}i(nt,"injectSignalAttr");function we(e,t,n,r,o){let c=`data-expr-${r}`;o.set(r,{type:t?"expression":"text",signal:e,bindAttr:c});let s=t?e():e;return`${n}<!--${c}-->${M(String(s))}<!--//${c}-->`}i(we,"injectExpr");function ve(e,t,n,r,o,c){let s=`data-expr-${t}`,l={type:"array",signal:o?()=>(e.__signal()||[]).map(e.__mapFn||(p=>p)):typeof c=="function"?c:()=>e,bindAttr:s};n.set(t,l);let a=(Array.isArray(e)?e:[]).map(I).join("");return`${r}<!--${s}-->${a}<!--//${s}-->`}i(ve,"injectArray");function I(e){if(e instanceof SVGElement){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.appendChild(e.cloneNode(!0)),t.innerHTML}return e==null||e===!1?"":Array.isArray(e)?e.reduce((t,n)=>t+I(n),""):T(e)?[...e.template.childNodes].reduce((t,n)=>(n.nodeType===1&&n.hasAttribute("key")&&(n.setAttribute("data-key",n.getAttribute("key")),n.removeAttribute("key")),t+(n.outerHTML||n.textContent)),""):e?.type==="template-array"?e.templates.reduce((t,n)=>t+I(n),""):M(String(e))}i(I,"processVal");function rt(e,...t){let n="",r=new Map,o=new Map,c=0,s=0;for(let f=0;f<e.length;f++)if(n+=e[f],f<t.length){let a=t[f],p=e[f].match(Le),d=!!p,V=p?.[1],Ie=n.match(Ae),B=n.match(Te),Ve=Ie&&typeof a=="function",Be=B&&typeof a=="function",je=B?B[1].slice(1):null;Ve?n=et(a,n,s++,o):Be?n=tt(a,je,n):(a?.signal||typeof a=="function")&&d?n=nt(a,V,n,c++,r):Array.isArray(a)&&a.__signalArray===!0?n=ve(a,c++,r,n,!0):a?.signal?n=we(a,!1,n,c++,r):typeof a=="function"?n=we(a,!0,n,c++,r):Array.isArray(a)?n=ve(a,c++,r,n,!1,a):a!=null&&(n+=I(a))}let l=document.createElement("template");return l.innerHTML=n.trim(),{template:l.content,signals:r,refs:o}}i(rt,"processTemplate");function Ce(e){try{return e()??null}catch{return null}}i(Ce,"evalExpr");function _e(e,...t){return rt(e,...t)}i(_e,"html");var z=new Map;function Ne(e,t){let n=ce(t);return z.has(e)||z.set(e,n.cloneNode(!0)),z.get(e).cloneNode(!0)}i(Ne,"cachedTemplate");function ot(e,{signal:t,bindAttr:n,renderer:r}){let[o,c]=_(e.shadowRoot,n);!o||!c||O(e,t,s=>r(o,c,s))}i(ot,"bindPlaceholderSignal");function be({host:e,type:t,signal:n,bindAttr:r}){ot(e,{signal:n,bindAttr:r,renderer:i((o,c,s)=>{let l=t==="expression"?Ce(()=>s):s;l!=null&&it(e,o,c,l)},"renderer")})}i(be,"handleSignalBinding");function it(e,t,n,r){if(Array.isArray(r)&&r.some(T)){F(t,n,t.__oldItems||[],r,e);return}let o=T(r)?r.template.cloneNode(!0).firstElementChild:document.createTextNode(String(r));le(t,n),o&&(n.parentNode.insertBefore(o,n),T(r)&&b(e,t,n))}i(it,"renderEvaluated");var J=i(e=>e&&!/^(data-|@|ref|key$)/.test(e)&&/^[a-z][\w\-_:]*$/i.test(e),"specialAttr");function $e(e){if(typeof e!="string")return e;let t=e.trim();if(!t)return t;let n=t.toLowerCase(),r={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:1/0,"-infinity":-1/0};if(n in r)return r[n];let o=Number(t);if(!Number.isNaN(o))return o;try{return JSON.parse(t)}catch{return t}}i($e,"coerceAttrValue");function st(e){e._props=e._props||{},e._propsSetters=e._propsSetters||{};for(let{name:t,value:n}of e.attributes){if(!J(t))continue;let r=$e(pe(n)),[o,c]=y(r);e._props[t]=o,e._propsSetters[t]=c}}i(st,"generateSpecialAttrSignals");function ct(e){let t=new MutationObserver(n=>{for(let r of n){if(r.type!=="attributes"||!J(r.attributeName))continue;let o=e._propsSetters[r.attributeName];if(o){let c=$e(e.getAttribute(r.attributeName));o(c)}}});t.observe(e,{attributes:!0,attributeOldValue:!0}),e._cleanup.add(()=>t.disconnect())}i(ct,"observeAttrMutations");function Me(e){st(e),ct(e)}i(Me,"initPropsAndObserve");function Re(e,t){let r=class r extends HTMLElement{constructor(){super(),fe(this),this._initInstanceState(),this.lifecycle=new x,u.currentComponent=this,Me(this),this.lifecycle.run("beforeMount",this),this._render()}_initInstanceState(){Object.assign(this,{_cleanup:new Set,_isUpdating:!1,_props:{},_eventIds:[]})}connectedCallback(){this.lifecycle.run("mount",this)}disconnectedCallback(){this.lifecycle.run("destroy",this),[...this._cleanup].forEach(c=>c()),this._cleanup.clear(),[...this._eventIds].forEach(({type:c,id:s})=>clearEventHandler(c,s)),this._eventIds=[]}_render(){C(this,()=>{this.lifecycle.run("beforeUpdate",this);let c=t.call(this,this._props),{template:s,signals:l,refs:f}=typeof c=="function"?c():c||{};this.shadowRoot.hasChildNodes()||this.shadowRoot.appendChild(Ne(e,s)),ye(this,l),b(this),Ee(this,f),this.lifecycle.run("update",this)})}};i(r,"EsorComponent");let n=r;return customElements.define(e,n),n}i(Re,"component");function Fe(){let e=null;return new Proxy(()=>{},{apply:i((t,n,[r])=>e=r,"apply"),get:i((t,n)=>e?.[n]?.bind?.(e)||e?.[n],"get"),set:i((t,n,r)=>e?(e[n]=r,!0):!1,"set")})}i(Fe,"useRef");function Oe(e){let[t,n]=y();return h(()=>n(e())),t}i(Oe,"useMemo");var X="esor-store:",ke=i((e,t={})=>{let n=t.persist?lt(t.persist):null,[r,o]=y(n||e),c=new Set;return t.persist&&h(()=>{let l=i(f=>{if(f.key===X+t.persist)try{o(JSON.parse(f.newValue))}catch(a){g(`Failed to sync state: ${a.message}`)}},"handleStorage");return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)}),[r,{setState(l){let f=typeof l=="function"?l(r()):l;o(f),t.persist&&ft(t.persist,f),c.forEach(a=>a(f))},subscribe(l){return c.add(l),()=>c.delete(l)},getState:r}]},"useStore");function lt(e){try{let t=localStorage.getItem(X+e);return t?JSON.parse(t):null}catch(t){return g(`Failed to load state: ${t.message}`),null}}i(lt,"loadFromStorage");function ft(e,t){try{localStorage.setItem(X+e,JSON.stringify(t))}catch(n){g(`Failed to save state: ${n.message}`)}}i(ft,"saveToStorage");export{te as beforeMount,re as beforeUpdate,Re as component,_e as html,ie as onDestroy,se as onEffect,ne as onMount,oe as onUpdate,ue as useBatch,ae as useComputed,h as useEffect,Se as useEmit,Oe as useMemo,Fe as useRef,y as useSignal,ke as useStore};
//# sourceMappingURL=esor.min.js.map
