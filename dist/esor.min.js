var J=Object.defineProperty;var W=e=>{throw TypeError(e)};var Re=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var o=(e,t)=>J(e,"name",{value:t,configurable:!0});var Q=(e,t,n)=>Re(e,typeof t!="symbol"?t+"":t,n),Y=(e,t,n)=>t.has(e)||W("Cannot "+n);var b=(e,t,n)=>(Y(e,t,"read from private field"),n?n.call(e):t.get(e)),I=(e,t,n)=>t.has(e)?W("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var G=(e,t,n)=>(Y(e,t,"access private method"),n);var h,v,X,A=class A{constructor(){I(this,v);I(this,h,new Map);A.current=this}add(t,n){return G(this,v,X).call(this,t).add(n),()=>b(this,h).get(t)?.delete(n)}run(t,n){b(this,h).get(t)?.forEach(r=>r.call(n))}clear(t){t?b(this,h).delete(t):b(this,h).clear()}};h=new WeakMap,v=new WeakSet,X=o(function(t){return b(this,h).has(t)||b(this,h).set(t,new Set),b(this,h).get(t)},"#hooks"),o(A,"Lifecycle"),Q(A,"current");var S=A,K=o(()=>S.current||(()=>{throw"Lifecycle not initialized"})(),"getLC"),[L,Z,ee,te,ne]=["beforeMount","mount","beforeUpdate","update","destroy"].map(e=>t=>K().add(e,t)),re=o(e=>{let t=e();return t instanceof Function&&K().add("destroy",t)||(()=>{})},"onEffect");var _={currentEffect:null,currentComponent:null,pendingEffects:new Set,isEffectsFlushing:!1,globalEvents:{handlersByType:new Map,nextId:0}},u=_;function $(e,t){let n=_.currentComponent;_.currentComponent=e;try{return t()}finally{_.currentComponent=n}}o($,"withCurrentComponent");function q(e,t){return!Object.is(e,t)}o(q,"valuesChanged");var oe=o(e=>e instanceof DocumentFragment&&e||e?.content?.cloneNode()||document.createDocumentFragment(),"getDocumentFragment");function ie(e,t){let n=e.nextSibling;for(;n&&n!==t;){let r=n.nextSibling;n.parentNode.removeChild(n),n=r}}o(ie,"removeChildNodesBetween");var N=o((e,t)=>{let n=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT),[r,s]=[null,null];for(;n.nextNode()&&!s;){let i=n.currentNode;!r&&i.nodeValue===t?r=i:r&&i.nodeValue===`//${t}`&&(s=i)}return[r,s]},"findCommentPlaceholders");function se(e){let n=HTMLElement.prototype.hasOwnProperty("attachInternals")?e.attachInternals():null;n?.shadowRoot?e.shadowRoot=n.shadowRoot:e.attachShadow({mode:"open"})}o(se,"setupDeclarativeShadowRoot");function U(){u.isEffectsFlushing||(u.isEffectsFlushing=!0,Promise.resolve().then(()=>{let e=new Set(u.pendingEffects);u.pendingEffects.clear(),e.forEach(t=>t()),u.isEffectsFlushing=!1}))}o(U,"flushEffects");function g(e){let t=o(()=>{let n=u.currentEffect;u.currentEffect=t;try{return e()}finally{u.currentEffect=n}},"effect");return t(),t}o(g,"useEffect");var M=0,C=new Set;function y(e){let t=new Set,n=e,r=o(()=>(u.currentEffect&&t.add(u.currentEffect),Array.isArray(n)?Oe(n,r):n),"read"),s=o(i=>{if(q(n,i)){if(n=i,M>0){t.forEach(c=>C.add(c));return}queueMicrotask(()=>{for(let c of t)typeof c=="function"&&u.pendingEffects.add(c);U()})}},"write");return r.valueOf=()=>r(),r.toString=()=>String(r()),r.signal=!0,r.cleanup=()=>{t.clear(),n=e},[r,s]}o(y,"useSignal");function ce(e){let[t,n]=y(e());return g(()=>{let r=e();q(t(),r)&&queueMicrotask(()=>n(r))}),t}o(ce,"useComputed");var Fe=["map","filter","find","findIndex","slice","concat","reduce","every","some","includes","push","pop","shift","unshift","splice","reverse","sort"];function Oe(e,t){return Fe.forEach(n=>{let r=e[n];e[n]=function(...s){let i=r.apply(this,s);return i.__signalArray=!0,i.__signal=t,i.__mapFn=s[0],i}}),e}o(Oe,"addSignalMap");function ae(e){M++;try{return e()}finally{if(M--,M===0&&C.size){let t=Array.from(C);C.clear(),t.forEach(n=>u.pendingEffects.add(n)),U()}}}o(ae,"useBatch");var R=o(e=>e==null?"":e.toString().replace(/[&<>'"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","/":"&#x2F;"})[t]),"escapeHTML");function le(e){return e==null?"":String(e).replace(/^["']|["']$/g,"").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}o(le,"cleanAttributeValue");function F(e,t,n,r,s){n=[...n||[]],r=[...r||[]];let i=t.parentNode,c=De(e,t),a=r.map((f,l)=>qe(f,Ie(f,l)));Be(i,c,a,t),E(s,e,t),e.__oldItems=[...r]}o(F,"reconcileArrays");function Be(e,t,n,r){let s=0,i=t.length,c=0,a=n.length,f=i&&t[i-1].nextSibling||r;for(;s<i&&c<a&&t[s]===n[c];)s++,c++;for(;i>s&&a>c&&t[i-1]===n[a-1];)i--,a--;let l=null;for(;s<i||c<a;)if(i===s){let p=a<n.length?c?n[c-1].nextSibling:n[a-c]:f;for(;c<a;)e.insertBefore(n[c++],p)}else if(a===c)for(;s<i;)e.removeChild(t[s++]);else if(t[s]===n[a-1]&&n[c]===t[i-1]){let p=t[--i].nextSibling;e.insertBefore(n[c++],t[s++].nextSibling),e.insertBefore(n[--a],p),t[i]=n[a]}else{l||(l=new Map(n.slice(c,a).map((d,m)=>[d,c+m])));let p=l.get(t[s]);if(p==null)e.removeChild(t[s++]);else if(c<p&&p<a){let d=1,m=s;for(;++m<i&&m<a&&l.get(t[m])===p+d;)d++;if(d>p-c){let B=t[s];for(;c<p;)e.insertBefore(n[c++],B)}else e.replaceChild(n[c++],t[s++])}else s++}}o(Be,"ddiff");function De(e,t,n=[]){for(let r=e?.nextSibling;r&&r!==t;r=r.nextSibling)n.push(r);return n}o(De,"collectDOMNodesBetween");function Ie(e,t){return e?.key??e?.id??`index-${t}`}o(Ie,"getItemKey");function qe(e,t){if(e?.template){let n=e.template.cloneNode(!0).childNodes[0]||document.createTextNode("");return n.nodeType===1&&t&&n.setAttribute("data-key",t),n}return document.createTextNode(e??"")}o(qe,"createItem");function O(e,t,n){let r=g(()=>{if(!e._isUpdating){e._isUpdating=!0;try{n(t())}finally{e._isUpdating=!1}}});e._cleanup.add(r)}o(O,"bindSignalToElement");function E(e,t,n){let{shadowRoot:r}=e,s=[];if(!t&&!n)r.nodeType===Node.ELEMENT_NODE&&s.push(r),s.push(...r.querySelectorAll("*"));else{let i=t?.nextSibling;for(;i&&i!==n;)i.nodeType===Node.ELEMENT_NODE&&s.push(i,...i.querySelectorAll("*")),i=i.nextSibling}for(let i of s)for(let c of i.attributes){if(!c.name.startsWith("data-event-"))continue;let a=c.name.replace("data-event-",""),f=parseInt(c.value,10),l=u.globalEvents.handlersByType.get(a)?.get(f);if(typeof l=="function"){let p=new AbortController;i.addEventListener(a,(...d)=>$(e,()=>l.call(e,...d)),{signal:p.signal}),e._cleanup.add(()=>p.abort()),i.removeAttribute(c.name)}}}o(E,"bindEventsInRange");function fe(e,t){t&&t.forEach(({type:n,signal:r,bindAttr:s,attributeName:i})=>{if(n==="attribute"){let c=e.shadowRoot.querySelector(`[${s}]`);if(!c)return;c.removeAttribute(s),O(e,r,a=>{let f=String(a);c.getAttribute(i)!==f&&c.setAttribute(i,f)})}else if(n==="array"){let[c,a]=N(e.shadowRoot,s);if(!c||!a)return;O(e,r,f=>{let l=c.__oldItems||[];F(c,a,l,Array.isArray(f)?f:[],e)})}else(n==="text"||n==="expression")&&pe({host:e,type:n,signal:r,bindAttr:s})})}o(fe,"setupSignals");function ue(e,t){t&&t.forEach((n,r)=>{let s=e.shadowRoot.querySelector(`[data-ref-${r}]`);s&&(s.removeAttribute(`data-ref-${r}`),n(s))})}o(ue,"setupRefs");var H={info:{color:"#0066cc",icon:"\u2139\uFE0F"},warn:{color:"#FFA500",icon:"\u26A0\uFE0F"},error:{color:"#FF0000",icon:"\u{1F6AB}"}},V=o((e="info",t="",...n)=>{H[e]||(e="info"),console.groupCollapsed(`%c[ESOR ${H[e].icon}${Ue(e)}] ${t}`,`color: ${H[e].color}; font-weight: bold;`),console[e]({message:t,component:u.currentComponent?.constructor?.name||"Unknown",time:new Date().toISOString(),data:n.length?n:void 0}),console[e==="error"?"trace":"debug"](),console.groupEnd()},"log"),Ue=o(e=>e?str.charAt(0).toUpperCase()+e.slice(1):"","capitalize"),$t=o((...e)=>V("info",...e),"info"),Nt=o((...e)=>V("warn",...e),"warn"),x=o((...e)=>V("error",...e),"error");function de(e,t){let n=u.globalEvents.handlersByType.get(e)||new Map,r=u.globalEvents.nextId++;return n.set(r,t),u.globalEvents.handlersByType.set(e,n),r}o(de,"registerEvent");function Ot(e,t){let n=u.globalEvents.handlersByType.get(e);n&&n.delete(t),n.size===0&&u.globalEvents.handlersByType.delete(e)}o(Ot,"clearEventHandler");function me(e,t){let n=u.currentComponent;n||x("useEmit must be used within a component");let r=new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,cancelable:!0});return r.__esor={name:e,detail:t,receivedBy:[]},n.dispatchEvent(r),r}o(me,"useEmit");var He=/\s(\w[\w-]*)=(["'])?(?:(?!\2).)*$/,he=/ref=(["'])?\s*$/,ge=/(@\w+)=(["'])?\s*$/,Ve=/(["'])\s*$/,ke=/^(script|style|textarea|title)$/i,Pe=o(e=>e.replace(Ve,""),"trimQuote"),k=o(e=>e.endsWith('"')?'"':"'","getQuote"),T=o(e=>e&&typeof e=="object"&&e.template,"isTemplateObject");function je(e,t,n,r){let s=k(t);return r.set(n,e),t.replace(he,`data-ref-${n}=${s}true${s}`)}o(je,"injectRef");function ze(e,t,n){let r=k(n),s=de(t,e);return e.isEventHandler=!0,n.replace(ge,`data-event-${t}=${r}${s}${r}`)}o(ze,"injectEvent");function Je(e,t,n,r,s){n=Pe(n);let i=k(n),c=typeof e=="function"?e():e,a=ke.test(t)?String(c):R(c),f=`data-bind-${r}`;return n+=`${a}" ${f}=${i}true${i}`,s.set(r,{type:"attribute",signal:e,attributeName:t,bindAttr:f}),n}o(Je,"injectSignalAttr");function ye(e,t,n,r,s){let i=`data-expr-${r}`;s.set(r,{type:t?"expression":"text",signal:e,bindAttr:i});let c=t?e():e;return`${n}<!--${i}-->${R(String(c))}<!--//${i}-->`}o(ye,"injectExpr");function be(e,t,n,r,s,i){let c=`data-expr-${t}`,a=`<!--${c}-->`;if(s){let f=e.__signal,l=e.__mapFn,p=o(()=>(f()||[]).map(l||(m=>m)),"arrFn"),d=p();for(let m of Array.isArray(d)?d:[])a+=w(m);n.set(t,{type:"array",signal:p,bindAttr:c})}else{let f=Array.isArray(e)?e:[];for(let l of f)a+=`<div>${w(l)}</div>`;n.set(t,{type:"array",bindAttr:c,signal:typeof i=="function"?i:()=>e})}return r+a+`<!--//${c}-->`}o(be,"injectArray");function w(e){return e==null||e===!1?"":Array.isArray(e)?e.reduce((t,n)=>t+w(n),""):T(e)?[...e.template.childNodes].reduce((t,n)=>(n.nodeType===1&&n.hasAttribute("key")&&(n.setAttribute("data-key",n.getAttribute("key")),n.removeAttribute("key")),t+(n.outerHTML||n.textContent)),""):e?.type==="template-array"?e.templates.reduce((t,n)=>t+w(n),""):R(String(e))}o(w,"processVal");function We(e,...t){let n="",r=new Map,s=new Map,i=0,c=0;for(let f=0;f<e.length;f++)if(n+=e[f],f<t.length){let l=t[f],p=e[f].match(He),d=!!p,m=p?.[1],B=n.match(he),D=n.match(ge),Ne=B&&typeof l=="function",Me=D&&typeof l=="function",Ce=D?D[1].slice(1):null;Ne?n=je(l,n,c++,s):Me?n=ze(l,Ce,n):(l?.signal||typeof l=="function")&&d?n=Je(l,m,n,i++,r):Array.isArray(l)&&l.__signalArray===!0?n=be(l,i++,r,n,!0):l?.signal?n=ye(l,!1,n,i++,r):typeof l=="function"?n=ye(l,!0,n,i++,r):Array.isArray(l)?n=be(l,i++,r,n,!1,l):l!=null&&(n+=w(l))}let a=document.createElement("template");return a.innerHTML=n.trim(),{template:a.content,signals:r,refs:s}}o(We,"processTemplate");function Ee(e,...t){return We(e,...t)}o(Ee,"html");function xe(e){try{return e()??null}catch{return null}}o(xe,"evalExpr");var P=new Map;function Se(e,t){let n=oe(t);return P.has(e)||P.set(e,n.cloneNode(!0)),P.get(e).cloneNode(!0)}o(Se,"cachedTemplate");function Qe(e,{signal:t,bindAttr:n,renderer:r}){let[s,i]=N(e.shadowRoot,n);!s||!i||O(e,t,c=>r(s,i,c))}o(Qe,"bindPlaceholderSignal");function pe({host:e,type:t,signal:n,bindAttr:r}){Qe(e,{signal:n,bindAttr:r,renderer:o((s,i,c)=>{let a=t==="expression"?xe(()=>c):c;a!=null&&Ye(e,s,i,a)},"renderer")})}o(pe,"handleSignalBinding");function Ye(e,t,n,r){if(r.type==="template-array"){F(t,n,t.__oldItems||[],r.templates,e);return}let s=T(r)?r.template.cloneNode(!0):document.createTextNode(String(r));ie(t,n),n.parentNode.insertBefore(s,n),T(r)&&E(e,t,n)}o(Ye,"renderEvaluated");var j=o(e=>e&&!/^(data-|@|ref$)/.test(e)&&/^[a-z][\w\-_:]*$/i.test(e),"specialAttr");function Ae(e){if(typeof e!="string")return e;let t=e.trim();if(!t)return t;let n=t.toLowerCase(),r={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:1/0,"-infinity":-1/0};if(n in r)return r[n];let s=Number(t);if(!Number.isNaN(s))return s;try{return JSON.parse(t)}catch{return t}}o(Ae,"coerceAttrValue");function Ge(e){for(let{name:t,value:n}of e.attributes){if(!j(t))continue;let[r,s]=y(Ae(le(n)));r.set=s,e._props[t]=r}}o(Ge,"generateSpecialAttrSignals");function Ke(e){let t=new MutationObserver(n=>{for(let r of n){if(r.type!=="attributes"||!j(r.attributeName))continue;let s=e._props[r.attributeName];s?.set&&s.set(Ae(e.getAttribute(r.attributeName)))}});t.observe(e,{attributes:!0,attributeOldValue:!0}),e._cleanup.add(()=>t.disconnect())}o(Ke,"observeAttrMutations");function we(e){Ge(e),Ke(e)}o(we,"initPropsAndObserve");function Te(e,t){let r=class r extends HTMLElement{constructor(){super(),se(this),this._cleanup=new Set,this._isUpdating=!1,this._props={},this.lifecycle=new S,u.currentComponent=this,we(this),this.lifecycle.run("beforeMount",this),this._render()}connectedCallback(){this.lifecycle.run("mount",this)}disconnectedCallback(){this.lifecycle.run("destroy",this),this._cleanup.forEach(i=>i()),this._cleanup.clear()}_render(){$(this,()=>{this.lifecycle.run("beforeUpdate",this);let i=t.call(this,this._props),{template:c,signals:a,refs:f}=typeof i=="function"?i():i||{};this.shadowRoot.hasChildNodes()||this.shadowRoot.appendChild(Se(e,c)),E(this),fe(this,a),ue(this,f),this.lifecycle.run("update",this)})}};o(r,"EsorComponent");let n=r;return customElements.define(e,n),n}o(Te,"component");function ve(){let e=null;return new Proxy(()=>{},{apply:o((t,n,[r])=>e=r,"apply"),get:o((t,n)=>e?.[n]?.bind?.(e)||e?.[n],"get"),set:o((t,n,r)=>e?(e[n]=r,!0):!1,"set")})}o(ve,"useRef");function _e(e){let[t,n]=y();return g(()=>n(e())),t}o(_e,"useMemo");var z="esor-store:",$e=o((e,t={})=>{let n=t.persist?Xe(t.persist):null,[r,s]=y(n||e),i=new Set;return t.persist&&g(()=>{let a=o(f=>{if(f.key===z+t.persist)try{s(JSON.parse(f.newValue))}catch(l){x(`Failed to sync state: ${l.message}`)}},"handleStorage");return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)}),[r,{setState(a){let f=typeof a=="function"?a(r()):a;s(f),t.persist&&Le(t.persist,f),i.forEach(l=>l(f))},subscribe(a){return i.add(a),()=>i.delete(a)},getState:r}]},"useStore");function Xe(e){try{let t=localStorage.getItem(z+e);return t?JSON.parse(t):null}catch(t){return x(`Failed to load state: ${t.message}`),null}}o(Xe,"loadFromStorage");function Le(e,t){try{localStorage.setItem(z+e,JSON.stringify(t))}catch(n){x(`Failed to save state: ${n.message}`)}}o(Le,"saveToStorage");export{L as beforeMount,ee as beforeUpdate,Te as component,Ee as html,ne as onDestroy,re as onEffect,Z as onMount,te as onUpdate,ae as useBatch,ce as useComputed,g as useEffect,me as useEmit,_e as useMemo,ve as useRef,y as useSignal,$e as useStore};
//# sourceMappingURL=esor.min.js.map
