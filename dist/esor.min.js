var X=Object.defineProperty;var K=e=>{throw TypeError(e)};var Ie=(e,t,n)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var i=(e,t)=>X(e,"name",{value:t,configurable:!0});var Q=(e,t,n)=>Ie(e,typeof t!="symbol"?t+"":t,n),Y=(e,t,n)=>t.has(e)||K("Cannot "+n);var y=(e,t,n)=>(Y(e,t,"read from private field"),n?n.call(e):t.get(e)),V=(e,t,n)=>t.has(e)?K("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var G=(e,t,n)=>(Y(e,t,"access private method"),n);var m,T,L,A=class A{constructor(){V(this,T);V(this,m,new Map);A.current=this}add(t,n){return G(this,T,L).call(this,t).add(n),()=>y(this,m).get(t)?.delete(n)}run(t,n){y(this,m).get(t)?.forEach(r=>{try{r.call(n)}catch(o){n._catchError(o)}})}clear(t){t?y(this,m).delete(t):y(this,m).clear()}};m=new WeakMap,T=new WeakSet,L=i(function(t){return y(this,m).has(t)||y(this,m).set(t,new Set),y(this,m).get(t)},"#hooks"),i(A,"Lifecycle"),Q(A,"current");var S=A,Z=i(()=>S.current||(()=>{throw"Lifecycle not initialized"})(),"getLC"),[ee,te,ne,re,oe]=["beforeMount","mount","beforeUpdate","update","destroy"].map(e=>t=>Z().add(e,t)),ie=i(e=>{let t=e();return t instanceof Function&&Z().add("destroy",t)||(()=>{})},"onEffect");var v={currentEffect:null,currentComponent:null,pendingEffects:new Set,isEffectsFlushing:!1,globalEvents:{handlersByType:new Map,nextId:0}},u=v;function w(e,t){let n=v.currentComponent;v.currentComponent=e;try{return t()}finally{v.currentComponent=n}}i(w,"withCurrentComponent");function I(e,t){return!Object.is(e,t)}i(I,"valuesChanged");var se=i(e=>e instanceof DocumentFragment&&e||e?.content?.cloneNode()||document.createDocumentFragment(),"getDocumentFragment");function ce(e,t){let n=e.nextSibling;for(;n&&n!==t;){let r=n.nextSibling;n.parentNode.removeChild(n),n=r}}i(ce,"removeChildNodesBetween");var C=i((e,t)=>{let n=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT),[r,o]=[null,null];for(;n.nextNode()&&!o;){let s=n.currentNode;!r&&s.nodeValue===t?r=s:r&&s.nodeValue===`//${t}`&&(o=s)}return[r,o]},"findCommentPlaceholders");function ae(e){let n=HTMLElement.prototype.hasOwnProperty("attachInternals")?e.attachInternals():null;n?.shadowRoot?e.shadowRoot=n.shadowRoot:e.attachShadow({mode:"open"})}i(ae,"setupDeclarativeShadowRoot");var je=["map","filter","find","findIndex","slice","concat","reduce","every","some","includes","push","pop","shift","unshift","splice","reverse","sort"];function le(e,t){for(let n of je){let r=e[n];e[n]=(...o)=>{let s=r.apply(e,o);return s instanceof Array&&(s.__signalArray=!0,s.__signal=t,s.__mapFn=o[0]),s}}return e}i(le,"addSignalMap");function j(){u.isEffectsFlushing||(u.isEffectsFlushing=!0,Promise.resolve().then(()=>{let e=new Set(u.pendingEffects);u.pendingEffects.clear(),e.forEach(t=>t()),u.isEffectsFlushing=!1}))}i(j,"flushEffects");function h(e){let t=i(()=>{let n=u.currentEffect;u.currentEffect=t;try{return e()}finally{u.currentEffect=n}},"effect");return t(),t}i(h,"useEffect");var _=0,$=new Set;function g(e){let t=new Set,n=e,r=i(()=>(u.currentEffect&&t.add(u.currentEffect),Array.isArray(n)?le(n,r):n),"read"),o=i(s=>{if(I(n,s)){if(n=s,_>0){t.forEach(c=>$.add(c));return}queueMicrotask(()=>{for(let c of t)typeof c=="function"&&u.pendingEffects.add(c);j()})}},"write");return r.valueOf=()=>r(),r.toString=()=>String(r()),r.signal=!0,r.cleanup=()=>{t.clear(),n=e},[r,o]}i(g,"useSignal");function fe(e){let[t,n]=g(e());return h(()=>{let r=e();I(t(),r)&&queueMicrotask(()=>n(r))}),t}i(fe,"useComputed");function ue(e){_++;try{return e()}finally{if(_--,_===0&&$.size){for(let t of $)u.pendingEffects.add(t);$.clear(),j()}}}i(ue,"useBatch");var M=i(e=>e==null?"":e.toString().replace(/[&<>'"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","/":"&#x2F;"})[t]),"escapeHTML");function pe(e){return e==null?"":String(e).replace(/^["']|["']$/g,"").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}i(pe,"cleanAttributeValue");function O(e,t,n,r,o){n=[...n||[]],r=[...r||[]];let s=t.parentNode,c=Ue(e,t),a=We(r,c,n);Xe(s,c,a,t),x(o,e,t),e.__oldItems=[...r]}i(O,"reconcileArrays");function Ue(e,t){let n=[],r=e.nextSibling;for(;r&&r!==t;)n.push(r),r=r.nextSibling;return n}i(Ue,"collectNodes");function b(e){return e&&e.nodeType===Node.ELEMENT_NODE}i(b,"isValidDOMNode");function qe(e){return b(e)?e.getAttribute("data-key"):null}i(qe,"getNodeKey");function Pe(e,t,n,r){if(!e||!t||!n||!r)return!1;if(n.template&&r.template){let o=de(e),s=de(t),c=!1;return o.forEach((a,f)=>{let l=s[f];l&&a.textContent!==l.textContent&&(a.textContent=l.textContent,c=!0)}),c}return!1}i(Pe,"updateNodeContent");function de(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),r;for(;r=n.nextNode();)t.push(r);return t}i(de,"getTextNodes");function We(e,t,n){let r=new Map,o=new Map;return t.forEach(s=>{let c=qe(s);c&&r.set(c,s)}),n.forEach((s,c)=>{let a=he(s,c);o.set(a,s)}),e.map((s,c)=>{let a=he(s,c),f=r.get(a),l=o.get(a);if(f&&b(f)){if(ze(l,s)){let p=ge(s,a);return Pe(f,p,l,s)?f:(Je(f,p),p)}return f}return ge(s,a)})}i(We,"createOrReuseNodes");function ze(e,t){if(!e||!t)return!0;if(e?.template&&t?.template){let n=me(e),r=me(t);return!R(n,r)}return!R(e,t)}i(ze,"hasChanged");function me(e){if(!e?.template)return null;let t=[],n=e.template.cloneNode(!0),r=document.createTreeWalker(n,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null,!1);for(;r.nextNode();){let o=r.currentNode;o.nodeType===Node.TEXT_NODE&&o.textContent.trim()?t.push(o.textContent):o.nodeType===Node.ELEMENT_NODE&&Array.from(o.attributes).forEach(s=>{s.value.includes("${")&&t.push(s.value)})}return t}i(me,"extractDynamicValues");function R(e,t){if(e===t)return!0;if(!e||!t||typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((n,r)=>R(n,t[r]));if(typeof e=="object"){let n=Object.keys(e),r=Object.keys(t);return n.length!==r.length?!1:n.every(o=>R(e[o],t[o]))}return String(e)===String(t)}i(R,"areValuesEqual");function Je(e,t){!b(e)||!b(t)||Array.from(e.attributes).forEach(n=>{n.name.startsWith("data-event-")&&t.setAttribute(n.name,n.value)})}i(Je,"copyEventAttributes");function he(e,t){if(e?.template){let n=e.template.firstElementChild;if(e.id)return`item-${e.id}`;if(n&&b(n)){let r=n.getAttribute("key");if(r)return r}return`template-${t}`}if(e&&typeof e=="object"){if(e.id)return`item-${e.id}`;try{return`item-${t}-${JSON.stringify(e)}`}catch{return`item-${t}`}}return`item-${t}-${String(e)}`}i(he,"getItemKey");function ge(e,t){let n;return e?.template?n=e.template.cloneNode(!0).firstElementChild||document.createElement("div"):(n=document.createElement("div"),n.textContent=String(e)),b(n)&&n.setAttribute("data-key",t),n}i(ge,"createNode");function Xe(e,t,n,r){let o=0,s=t.length,c=0,a=n.length,f=s>0&&t[s-1].nextSibling||r,l=null;if(s===0){for(let p=0;p<a;p++)e.insertBefore(n[p],f);return}if(a===0){for(;o<s;)e.removeChild(t[o++]);return}for(;o<s||c<a;){if(t[o]===n[c]){o++,c++;continue}for(;t[s-1]===n[a-1];)s--,a--;if(o===s){let p=a<n.length?c?n[c-1].nextSibling:n[a-c]:f;for(;c<a;)e.insertBefore(n[c++],p)}else if(c===a)for(;o<s;)(!l||!l.has(t[o]))&&e.removeChild(t[o]),o++;else if(t[o]===n[a-1]&&n[c]===t[s-1]){let p=t[--s].nextSibling;e.insertBefore(n[c++],t[o++].nextSibling),e.insertBefore(n[--a],p),t[s]=n[a]}else{if(!l){l=new Map;for(let d=c;d<a;d++)l.set(n[d],d)}let p=l.get(t[o]);if(p==null)e.removeChild(t[o++]);else if(c<p&&p<a){let d=1;for(;o+d<s&&p+d<a&&t[o+d]===n[p+d];)d++;if(d>p-c){let D=t[o];for(;c<p;)e.insertBefore(n[c++],D)}else e.replaceChild(n[c++],t[o++])}else o++}}}i(Xe,"ddiff");function k(e,t,n){let r=h(()=>{if(!e._isUpdating){e._isUpdating=!0;try{n(t())}finally{e._isUpdating=!1}}});e._cleanup.add(r)}i(k,"bindSignalToElement");function x(e,t,n){let{shadowRoot:r}=e,o=Ke(r,t,n);Qe(e,o)}i(x,"bindEventsInRange");function Ke(e,t,n){let r=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null);if(!t&&!n)for(;o.nextNode();)r.push(o.currentNode);else{let s=t?.nextSibling||e.firstChild;if(!s)return r;o.currentNode=s;do{if(o.currentNode===n)break;r.push(o.currentNode)}while(o.nextNode())}return r}i(Ke,"getElementsInRange");function Qe(e,t){for(let n of t)for(let r of Array.from(n.attributes)){if(!r.name.startsWith("data-event-"))continue;let o=r.name.replace("data-event-",""),s=parseInt(r.value,10),c=u.globalEvents.handlersByType.get(o)?.get(s);typeof c=="function"&&(n.addEventListener(o,(...a)=>w(e,()=>c.call(e,...a))),n.removeAttribute(r.name))}}i(Qe,"bindEvents");function ye(e,t){t&&t.forEach(({type:n,signal:r,bindAttr:o,attributeName:s})=>{if(n==="attribute"){let c=e.shadowRoot.querySelector(`[${o}]`);if(!c)return;c.removeAttribute(o),k(e,r,a=>{let f=String(a);c.getAttribute(s)!==f&&c.setAttribute(s,f)})}else if(n==="array"){let[c,a]=C(e.shadowRoot,o);if(!c||!a)return;k(e,r,f=>{let l=c.__oldItems||[];O(c,a,l,Array.isArray(f)?f:[],e)})}else(n==="text"||n==="expression")&&be({host:e,type:n,signal:r,bindAttr:o})})}i(ye,"setupSignals");function Ee(e,t){if(t)for(let[n,r]of t.entries()){let o=e.shadowRoot.querySelector(`[data-ref-${n}]`);o&&(o.removeAttribute(`data-ref-${n}`),r(o))}}i(Ee,"setupRefs");var U={info:{color:"#0066cc",icon:"\u2139\uFE0F"},warn:{color:"#FFA500",icon:"\u26A0\uFE0F"},error:{color:"#FF0000",icon:"\u{1F6AB}"}},q=i((e="info",t="",...n)=>{U[e]||(e="info"),console.groupCollapsed(`%c[ESOR ${U[e].icon}${Ye(e)}] ${t}`,`color: ${U[e].color}; font-weight: bold;`),console[e]({message:t,component:u.currentComponent?.constructor?.name||"Unknown",time:new Date().toISOString(),data:n.length?n:void 0}),console[e==="error"?"trace":"debug"](),console.groupEnd()},"log"),Ye=i(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"","capitalize"),qt=i((...e)=>q("info",...e),"info"),Pt=i((...e)=>q("warn",...e),"warn"),E=i((...e)=>q("error",...e),"error");var F=new Map;function xe(e,t){if(!e||typeof t!="function")return E("Invalid event registration parameters"),-1;let n=F.get(e);n||(n=new Map,F.set(e,n));let r=u.globalEvents.handlersByType.get(e);r||(r=new Map,u.globalEvents.handlersByType.set(e,r));let o=u.globalEvents.nextId++,s=u.currentComponent;return s&&s._eventIds.push({type:e,id:o}),r.set(o,t),n.set(o,t),o}i(xe,"registerEvent");function Kt(e,t){let n=u.globalEvents.handlersByType.get(e);if(n){n.delete(t),n.size===0&&u.globalEvents.handlersByType.delete(e);let r=F.get(e);r&&(r.delete(t),r.size===0&&F.delete(e))}}i(Kt,"clearEventHandler");function Se(e,t){let n=u.currentComponent;if(!n)return E("useEmit must be used within a component"),null;let r=new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,cancelable:!0});return r.__esor={name:e,detail:t,receivedBy:[],timestamp:Date.now()},n.dispatchEvent(r),r}i(Se,"useEmit");var Ge=/\s(\w[\w-]*)=(["'])?(?:(?!\2).)*$/,Ae=/ref=(["'])?\s*$/,Ne=/(@\w+)=(["'])?\s*$/,Ze=/(["'])\s*$/,Le=/^(script|style|textarea|title)$/i,et=i(e=>e.replace(Ze,""),"trimQuote"),P=i(e=>e.charAt(e.length-1)==='"'?'"':"'","getQuote"),N=i(e=>e&&typeof e=="object"&&e.template,"isTemplateObject");function tt(e,t,n,r){let o=P(t);return r.set(n,e),t.replace(Ae,`data-ref-${n}=${o}true${o}`)}i(tt,"injectRef");function nt(e,t,n){let r=P(n),o=xe(t,e);return e.isEventHandler=!0,n.replace(Ne,`data-event-${t}=${r}${o}${r}`)}i(nt,"injectEvent");function rt(e,t,n,r,o){n=et(n);let s=P(n),c=typeof e=="function"?e():e,a=Le.test(t)?String(c):M(c),f=`data-bind-${r}`;return n+=`${a} '' ${f}=${s}true${s}`,o.set(r,{type:"attribute",signal:e,attributeName:t,bindAttr:f}),n}i(rt,"injectSignalAttr");function Te(e,t,n,r,o){let s=`data-expr-${r}`;o.set(r,{type:t?"expression":"text",signal:e,bindAttr:s});let c=t?e():e;return`${n}<!--${s}-->${M(String(c))}<!--//${s}-->`}i(Te,"injectExpr");function ve(e,t,n,r,o,s){let c=`data-expr-${t}`,a={type:"array",signal:o?()=>(e.__signal()||[]).map(e.__mapFn||(p=>p)):typeof s=="function"?s:()=>e,bindAttr:c};n.set(t,a);let l=(Array.isArray(e)?e:[]).map(B).join("");return`${r}<!--${c}-->${l}<!--//${c}-->`}i(ve,"injectArray");function B(e){return e==null||e===!1?"":Array.isArray(e)?e.reduce((t,n)=>t+B(n),""):N(e)?[...e.template.childNodes].reduce((t,n)=>(n.nodeType===1&&n.hasAttribute("key")&&(n.setAttribute("data-key",n.getAttribute("key")),n.removeAttribute("key")),t+(n.outerHTML||n.textContent)),""):e?.type==="template-array"?e.templates.reduce((t,n)=>t+B(n),""):M(String(e))}i(B,"processVal");function ot(e,...t){let n="",r=new Map,o=new Map,s=0,c=0;for(let f=0;f<e.length;f++)if(n+=e[f],f<t.length){let l=t[f],p=e[f].match(Ge),d=!!p,D=p?.[1],Be=n.match(Ae),H=n.match(Ne),De=Be&&typeof l=="function",He=H&&typeof l=="function",Ve=H?H[1].slice(1):null;De?n=tt(l,n,c++,o):He?n=nt(l,Ve,n):(l?.signal||typeof l=="function")&&d?n=rt(l,D,n,s++,r):Array.isArray(l)&&l.__signalArray===!0?n=ve(l,s++,r,n,!0):l?.signal?n=Te(l,!1,n,s++,r):typeof l=="function"?n=Te(l,!0,n,s++,r):Array.isArray(l)?n=ve(l,s++,r,n,!1,l):l!=null&&(n+=B(l))}let a=document.createElement("template");return a.innerHTML=n.trim(),{template:a.content,signals:r,refs:o}}i(ot,"processTemplate");function we(e){try{return e()??null}catch{return null}}i(we,"evalExpr");function Ce(e,...t){return ot(e,...t)}i(Ce,"html");var W=new Map;function _e(e,t){let n=se(t);return W.has(e)||W.set(e,n.cloneNode(!0)),W.get(e).cloneNode(!0)}i(_e,"cachedTemplate");function it(e,{signal:t,bindAttr:n,renderer:r}){let[o,s]=C(e.shadowRoot,n);!o||!s||k(e,t,c=>r(o,s,c))}i(it,"bindPlaceholderSignal");function be({host:e,type:t,signal:n,bindAttr:r}){it(e,{signal:n,bindAttr:r,renderer:i((o,s,c)=>{let a=t==="expression"?we(()=>c):c;a!=null&&st(e,o,s,a)},"renderer")})}i(be,"handleSignalBinding");function st(e,t,n,r){if(Array.isArray(r)&&r.some(N)){O(t,n,t.__oldItems||[],r,e);return}let o=N(r)?r.template.cloneNode(!0).firstElementChild:document.createTextNode(String(r));ce(t,n),o&&(n.parentNode.insertBefore(o,n),N(r)&&x(e,t,n))}i(st,"renderEvaluated");var z=i(e=>e&&!/^(data-|@|ref|key$)/.test(e)&&/^[a-z][\w\-_:]*$/i.test(e),"specialAttr");function $e(e){if(typeof e!="string")return e;let t=e.trim();if(!t)return t;let n=t.toLowerCase(),r={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:1/0,"-infinity":-1/0};if(n in r)return r[n];let o=Number(t);if(!Number.isNaN(o))return o;try{return JSON.parse(t)}catch{return t}}i($e,"coerceAttrValue");function ct(e){for(let{name:t,value:n}of e.attributes){if(!z(t))continue;let[r,o]=g($e(pe(n)));r.set=o,e._props[t]=r}}i(ct,"generateSpecialAttrSignals");function at(e){let t=new MutationObserver(n=>{for(let r of n){if(r.type!=="attributes"||!z(r.attributeName))continue;let o=e._props[r.attributeName];o?.set&&o.set($e(e.getAttribute(r.attributeName)))}});t.observe(e,{attributes:!0,attributeOldValue:!0}),e._cleanup.add(()=>t.disconnect())}i(at,"observeAttrMutations");function Me(e){ct(e),at(e)}i(Me,"initPropsAndObserve");function Re(e,t){let r=class r extends HTMLElement{constructor(){super(),ae(this),this._cleanup=new Set,this._isUpdating=!1,this._props={},this.lifecycle=new S,u.currentComponent=this,this._eventIds=[],Me(this),this.lifecycle.run("beforeMount",this),this._render()}connectedCallback(){this.lifecycle.run("mount",this)}disconnectedCallback(){this.lifecycle.run("destroy",this),this._cleanup.forEach(s=>s()),this._cleanup.clear(),this._eventIds.forEach(({type:s,id:c})=>{clearEventHandler(s,c)}),this._eventIds=[]}_render(){w(this,()=>{this.lifecycle.run("beforeUpdate",this);let s=t.call(this,this._props),{template:c,signals:a,refs:f}=typeof s=="function"?s():s||{};this.shadowRoot.hasChildNodes()||this.shadowRoot.appendChild(_e(e,c)),ye(this,a),x(this),Ee(this,f),this.lifecycle.run("update",this)})}};i(r,"EsorComponent");let n=r;return customElements.define(e,n),n}i(Re,"component");function Oe(){let e=null;return new Proxy(()=>{},{apply:i((t,n,[r])=>e=r,"apply"),get:i((t,n)=>e?.[n]?.bind?.(e)||e?.[n],"get"),set:i((t,n,r)=>e?(e[n]=r,!0):!1,"set")})}i(Oe,"useRef");function ke(e){let[t,n]=g();return h(()=>n(e())),t}i(ke,"useMemo");var J="esor-store:",Fe=i((e,t={})=>{let n=t.persist?lt(t.persist):null,[r,o]=g(n||e),s=new Set;return t.persist&&h(()=>{let a=i(f=>{if(f.key===J+t.persist)try{o(JSON.parse(f.newValue))}catch(l){E(`Failed to sync state: ${l.message}`)}},"handleStorage");return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)}),[r,{setState(a){let f=typeof a=="function"?a(r()):a;o(f),t.persist&&ft(t.persist,f),s.forEach(l=>l(f))},subscribe(a){return s.add(a),()=>s.delete(a)},getState:r}]},"useStore");function lt(e){try{let t=localStorage.getItem(J+e);return t?JSON.parse(t):null}catch(t){return E(`Failed to load state: ${t.message}`),null}}i(lt,"loadFromStorage");function ft(e,t){try{localStorage.setItem(J+e,JSON.stringify(t))}catch(n){E(`Failed to save state: ${n.message}`)}}i(ft,"saveToStorage");export{ee as beforeMount,ne as beforeUpdate,Re as component,Ce as html,oe as onDestroy,ie as onEffect,te as onMount,re as onUpdate,ue as useBatch,fe as useComputed,h as useEffect,Se as useEmit,ke as useMemo,Oe as useRef,g as useSignal,Fe as useStore};
//# sourceMappingURL=esor.min.js.map
